<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>MPC Wallet</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            .fade-in {
                animation: fadeIn 0.3s ease-out;
            }
            .wallet-card {
                transition: all 0.2s ease;
            }
            .wallet-card:hover {
                transform: translateY(-2px);
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            }
            .loading {
                display: inline-block;
                width: 20px;
                height: 20px;
                border: 3px solid rgba(255, 255, 255, 0.3);
                border-radius: 50%;
                border-top-color: #fff;
                animation: spin 1s ease-in-out infinite;
            }
            @keyframes spin {
                to {
                    transform: rotate(360deg);
                }
            }
        </style>
    </head>
    <body class="bg-gray-50 min-h-screen">
        <!-- Navigation -->
        <nav class="bg-white shadow-sm border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center">
                        <svg
                            class="w-8 h-8 text-blue-600"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"
                            />
                        </svg>
                        <h1 class="ml-3 text-xl font-bold text-gray-900">
                            MPC Wallet
                        </h1>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button
                            onclick="showTab('dashboard')"
                            class="nav-btn px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100 transition"
                        >
                            Dashboard
                        </button>
                        <button
                            onclick="showTab('wallets')"
                            class="nav-btn px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100 transition"
                        >
                            Wallets
                        </button>
                        <button
                            onclick="showTab('send')"
                            class="nav-btn px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100 transition"
                        >
                            Send
                        </button>
                        <button
                            onclick="showTab('settings')"
                            class="nav-btn px-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-100 transition"
                        >
                            Settings
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Dashboard Tab -->
            <div id="dashboard-tab" class="tab-content fade-in">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">Dashboard</h2>
                    <p class="text-gray-600">Overview of your MPC wallets</p>
                </div>

                <!-- Quick Stats -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <svg
                                    class="w-8 h-8 text-blue-600"
                                    fill="none"
                                    stroke="currentColor"
                                    viewBox="0 0 24 24"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"
                                    />
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm text-gray-600">
                                    Total Balance
                                </p>
                                <p
                                    id="total-balance"
                                    class="text-2xl font-semibold text-gray-900"
                                >
                                    Loading...
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <svg
                                    class="w-8 h-8 text-green-600"
                                    fill="none"
                                    stroke="currentColor"
                                    viewBox="0 0 24 24"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"
                                    />
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm text-gray-600">
                                    Active Wallets
                                </p>
                                <p
                                    id="wallet-count"
                                    class="text-2xl font-semibold text-gray-900"
                                >
                                    0
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow p-6">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <svg
                                    class="w-8 h-8 text-purple-600"
                                    fill="none"
                                    stroke="currentColor"
                                    viewBox="0 0 24 24"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"
                                    />
                                </svg>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm text-gray-600">MPC Status</p>
                                <p
                                    id="mpc-status"
                                    class="text-2xl font-semibold text-green-600"
                                >
                                    Active
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Wallets -->
                <div class="bg-white rounded-lg shadow">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900">
                            Your Wallets
                        </h3>
                    </div>
                    <div id="dashboard-wallets" class="p-6">
                        <div class="text-center text-gray-500 py-8">
                            Loading wallets...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Wallets Tab -->
            <div id="wallets-tab" class="tab-content hidden">
                <div class="mb-6 flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">
                            Wallets
                        </h2>
                        <p class="text-gray-600">Manage your MPC wallets</p>
                    </div>
                    <button
                        onclick="showCreateWallet()"
                        class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium flex items-center transition"
                    >
                        <svg
                            class="w-5 h-5 mr-2"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M12 4v16m8-8H4"
                            />
                        </svg>
                        Create Wallet
                    </button>
                </div>

                <!-- Create Wallet Form -->
                <div
                    id="create-wallet-form"
                    class="bg-white rounded-lg shadow p-6 mb-6 hidden fade-in"
                >
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">
                        Create New Wallet
                    </h3>
                    <form onsubmit="createWallet(event)">
                        <div class="space-y-4">
                            <div>
                                <label
                                    class="block text-sm font-medium text-gray-700 mb-2"
                                    >Wallet Name</label
                                >
                                <input
                                    type="text"
                                    id="wallet-name"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="My Bitcoin Wallet"
                                    required
                                />
                            </div>
                            <div>
                                <label
                                    class="block text-sm font-medium text-gray-700 mb-2"
                                    >Signature Type</label
                                >
                                <div class="grid grid-cols-2 gap-4">
                                    <label class="cursor-pointer">
                                        <input
                                            type="radio"
                                            name="wallet-type"
                                            value="cggmp24"
                                            checked
                                            class="peer sr-only"
                                        />
                                        <div
                                            class="p-4 border-2 border-gray-300 rounded-lg peer-checked:border-blue-600 peer-checked:bg-blue-50 transition"
                                        >
                                            <p
                                                class="font-medium text-gray-900"
                                            >
                                                CGGMP24
                                            </p>
                                            <p class="text-sm text-gray-600">
                                                SegWit (ECDSA)
                                            </p>
                                        </div>
                                    </label>
                                    <label class="cursor-pointer">
                                        <input
                                            type="radio"
                                            name="wallet-type"
                                            value="taproot"
                                            class="peer sr-only"
                                        />
                                        <div
                                            class="p-4 border-2 border-gray-300 rounded-lg peer-checked:border-blue-600 peer-checked:bg-blue-50 transition"
                                        >
                                            <p
                                                class="font-medium text-gray-900"
                                            >
                                                Taproot
                                            </p>
                                            <p class="text-sm text-gray-600">
                                                FROST (Schnorr)
                                            </p>
                                        </div>
                                    </label>
                                </div>
                            </div>
                            <div>
                                <label
                                    class="block text-sm font-medium text-gray-700 mb-2"
                                    >Threshold</label
                                >
                                <input
                                    type="number"
                                    id="wallet-threshold"
                                    value="3"
                                    min="2"
                                    max="10"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                />
                                <p class="text-sm text-gray-500 mt-1">
                                    Number of parties required to sign
                                </p>
                            </div>
                            <div class="flex space-x-3">
                                <button
                                    type="submit"
                                    class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition"
                                >
                                    <span id="create-btn-text"
                                        >Create Wallet</span
                                    >
                                    <span id="create-btn-loading" class="hidden"
                                        ><span class="loading"></span>
                                        Creating...</span
                                    >
                                </button>
                                <button
                                    type="button"
                                    onclick="hideCreateWallet()"
                                    class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 px-4 py-2 rounded-lg font-medium transition"
                                >
                                    Cancel
                                </button>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Wallets List -->
                <div id="wallets-list" class="space-y-4">
                    <div class="text-center text-gray-500 py-8">
                        Loading wallets...
                    </div>
                </div>
            </div>

            <!-- Send Tab -->
            <div id="send-tab" class="tab-content hidden">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">
                        Send Bitcoin
                    </h2>
                    <p class="text-gray-600">
                        Transfer Bitcoin using threshold signatures
                    </p>
                </div>

                <div class="bg-white rounded-lg shadow p-6 max-w-2xl">
                    <form onsubmit="sendBitcoin(event)">
                        <div class="space-y-4">
                            <div>
                                <label
                                    class="block text-sm font-medium text-gray-700 mb-2"
                                    >From Wallet</label
                                >
                                <select
                                    id="send-wallet"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    required
                                    onchange="updateWalletBalance()"
                                >
                                    <option value="">Select a wallet...</option>
                                </select>
                                <p
                                    id="wallet-balance-info"
                                    class="text-sm text-gray-500 mt-1"
                                ></p>
                            </div>
                            <div>
                                <label
                                    class="block text-sm font-medium text-gray-700 mb-2"
                                    >Recipient Address</label
                                >
                                <input
                                    type="text"
                                    id="send-to"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent font-mono text-sm"
                                    placeholder="bc1q..."
                                    required
                                />
                            </div>
                            <div>
                                <label
                                    class="block text-sm font-medium text-gray-700 mb-2"
                                    >Amount (satoshis)</label
                                >
                                <input
                                    type="number"
                                    id="send-amount"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="10000"
                                    min="546"
                                    required
                                />
                                <p class="text-sm text-gray-500 mt-1">
                                    Minimum: 546 sats (dust limit) | 1 BTC =
                                    100,000,000 sats
                                </p>
                            </div>
                            <div>
                                <label
                                    class="block text-sm font-medium text-gray-700 mb-2"
                                    >Fee Rate (sat/vB)</label
                                >
                                <input
                                    type="number"
                                    id="send-fee"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    placeholder="1"
                                />
                                <p class="text-sm text-gray-500 mt-1">
                                    Leave empty for automatic fee estimation
                                </p>
                            </div>
                            <button
                                type="submit"
                                class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg font-medium transition"
                            >
                                <span id="send-btn-text">Send Bitcoin</span>
                                <span id="send-btn-loading" class="hidden"
                                    ><span class="loading"></span>
                                    Sending...</span
                                >
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Transaction Result -->
                <div id="tx-result" class="mt-6 hidden max-w-2xl">
                    <div
                        class="bg-green-50 border border-green-200 rounded-lg p-6"
                    >
                        <h3 class="text-lg font-semibold text-green-900 mb-2">
                            Transaction Broadcast!
                        </h3>
                        <div class="space-y-2 text-sm">
                            <p class="text-gray-700">
                                <span class="font-medium">TXID:</span>
                                <span
                                    id="tx-id"
                                    class="font-mono break-all"
                                ></span>
                            </p>
                            <p class="text-gray-700">
                                <span class="font-medium">Amount:</span>
                                <span id="tx-amount"></span> sats
                            </p>
                            <p class="text-gray-700">
                                <span class="font-medium">Fee:</span>
                                <span id="tx-fee"></span> sats
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settings-tab" class="tab-content hidden">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">Settings</h2>
                    <p class="text-gray-600">Configure your MPC wallet</p>
                </div>

                <div class="bg-white rounded-lg shadow p-6 max-w-2xl">
                    <div class="space-y-6">
                        <div>
                            <label
                                class="block text-sm font-medium text-gray-700 mb-2"
                                >Coordinator URL</label
                            >
                            <input
                                type="text"
                                id="coordinator-url"
                                value="http://localhost:3000"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            />
                            <p class="text-sm text-gray-500 mt-1">
                                Default: http://localhost:3000
                            </p>
                        </div>
                        <div>
                            <h3 class="text-sm font-medium text-gray-700 mb-2">
                                MPC Node Initialization
                            </h3>
                            <div
                                class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-3"
                            >
                                <p class="text-sm text-yellow-800 mb-2">
                                    Before creating wallets, MPC nodes must be
                                    initialized with CGGMP24 parameters.
                                </p>
                                <div id="node-status" class="text-sm mb-3">
                                    <p class="text-gray-600">
                                        Checking node status...
                                    </p>
                                </div>
                                <button
                                    onclick="initializeCggmp24()"
                                    class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg font-medium transition w-full"
                                >
                                    <span id="init-btn-text"
                                        >Initialize CGGMP24 Nodes</span
                                    >
                                    <span id="init-btn-loading" class="hidden"
                                        ><span class="loading"></span>
                                        Initializing...</span
                                    >
                                </button>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-sm font-medium text-gray-700 mb-2">
                                Regtest Mining (Local Testing Only)
                            </h3>
                            <div
                                class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-3"
                            >
                                <p class="text-sm text-blue-800 mb-3">
                                    Mine blocks to confirm transactions and
                                    generate test coins in regtest mode.
                                </p>
                                <div class="flex items-center space-x-3 mb-3">
                                    <select
                                        id="mine-wallet"
                                        class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
                                    >
                                        <option value="">
                                            Select wallet for mining rewards...
                                        </option>
                                    </select>
                                    <input
                                        type="number"
                                        id="mine-blocks"
                                        value="1"
                                        min="1"
                                        max="500"
                                        class="w-24 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
                                        placeholder="Blocks"
                                    />
                                </div>
                                <div class="flex space-x-2">
                                    <button
                                        onclick="mineBlocks(1)"
                                        class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg font-medium transition text-sm"
                                    >
                                        Mine 1 Block
                                    </button>
                                    <button
                                        onclick="mineBlocks(10)"
                                        class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg font-medium transition text-sm"
                                    >
                                        Mine 10 Blocks
                                    </button>
                                    <button
                                        onclick="mineBlocks(101)"
                                        class="flex-1 bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg font-medium transition text-sm"
                                    >
                                        Mine 101 (Mature Coinbase)
                                    </button>
                                </div>
                                <div id="mine-result" class="mt-3 hidden">
                                    <p class="text-sm text-green-700"></p>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-sm font-medium text-gray-700 mb-2">
                                System Information
                            </h3>
                            <div
                                id="system-info"
                                class="bg-gray-50 rounded-lg p-4 space-y-2 text-sm"
                            >
                                <p class="text-gray-500">Loading...</p>
                            </div>
                        </div>
                        <button
                            onclick="saveSettings()"
                            class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition"
                        >
                            Save Settings
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Toast Notification -->
        <div id="toast" class="fixed bottom-4 right-4 hidden">
            <div class="bg-gray-900 text-white px-6 py-3 rounded-lg shadow-lg">
                <p id="toast-message"></p>
            </div>
        </div>

        <script src="app.js"></script>
    </body>
</html>
